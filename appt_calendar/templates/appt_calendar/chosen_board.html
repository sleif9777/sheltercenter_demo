{% extends 'dashboard/base.html' %}
{% load static %}
{% load auth_extras %}
{% load appt_extras %}

{% block content %}
  <div class="main textpage">

    <h1 class="page_header no_actions">Chosen Board</h1>

    {% if paper_appointments|length > 0 %}
    <h2>Paperwork Scheduled</h2><br>

    <table id="chosenboard" style="width: 95%;">

      <tr class="no-border" style="margin-bottom: 5px;">
        <th style="width:15%;">Date</th>
        <th style="width:10%;">Dog</th>
        <th style="width:10%;">Outcome</th>
        <th style="width:17%;">Adopter</th>
        {% if request.user|has_group:"admin" %}
          <th style="width:20%;">Last Update Sent</th>
          <th style="width:18%;">Update Status</th>
        {% endif %}
      </tr>

      {% for appt in paper_appointments %}
        <!-- appts with chosen or paperwork status -->

          <tr>
            <td>{{appt.date}}</td>
            <td>{{appt.dog}}</td>
            <td>{{appt.get_outcome_display}}</td>
            <td>
              {{appt.adopter.f_name}} {{appt.adopter.l_name}}
              {% if request.user|has_group:"admin" %}
                <div class="chosen_board_actions" style="display: inline;">
                  <a href="{% url 'clear_from_cb' appt.id %}">(Cancel)</a>
                </div>
              {% endif %}
            </td>

            {% if request.user|has_group:"admin" %}
              <td>
                <div class="chosen_board_actions">
                  {% if appt|alert_overdue == True %}
                    <div class="" style="color: #BF4580;">
                      <b>&#9888;&#xFE0E; {{appt.last_update_sent}}</b>
                    </div>
                  {% else %}
                    <div class="">
                      {{appt.last_update_sent}}
                    </div>
                  {% endif %}
                  {% if request.user|has_group:"admin" %}
                    <a href="{% url 'contact_adopter' appt.id appt.date.year appt.date.month appt.date.day 'update' %}">Send Update</a><br>
                    {% if appt.all_updates_sent|length > 1 %}
                    <span style="font-size: 9pt; font-style: italic; padding-top: 5px;">
                      <b>Previous Updates:</b><br>
                      <ul>
                        {% for update in appt.all_updates_sent %}
                        <li>{{update}}</li>
                        {% endfor %}
                      </ul>
                    </span>
                    {% endif %}
                  {% endif %}
                </div>
              </td>

              <td class="chosenboard">
                {% if appt|is_chosen %}
                  <div class="chosen_board_actions">
                    <!-- <a href="{% url 'cb_update_status' appt.id 9 %}">Chosen - needs vetting</a><br>
                    <a href="{% url 'cb_update_status' appt.id 10 %}">Chosen - needs well check</a><br> -->
                    <a href="{% url 'contact_adopter' appt.id appt.date.year appt.date.month appt.date.day 'ready_negative' %}">Chosen - Dog Vetted</a><br>
                    <a href="{% url 'contact_adopter' appt.id appt.date.year appt.date.month appt.date.day 'ready_positive' %}">Vetted - Heartworm Positive</a>
                  </div>
                {% elif appt.outcome == "7" %}
                  Adopter Notified<br>
                  {% if appt.rtr_notif_date %}
                    ({{appt.rtr_notif_date}})<br>
                  {% endif %}
                  {% if appt.heartworm == True %}
                    <div class="chosen_board_actions">
                      <a class="chosen_board_actions" href="{% url 'paperwork_calendar' today.year today.month today.day appt.id 'positive' %}">Add FTA Appointment</a>
                    </div>
                  {% else %}
                    <div class="chosen_board_actions">
                      <a class="chosen_board_actions" href="{% url 'paperwork_calendar' today.year today.month today.day appt.id 'negative' %}">Add Paperwork Appointment</a>
                    </div>
                  {% endif %}
                {% elif appt.outcome == "8" %}
                  Adopter Notified<br>
                  Paperwork Scheduled
                  <div class="chosen_board_actions" style="display: inline;">
                    <a href="{% url 'mark_complete_cb' appt.id %}">Mark as Complete</a>
                  </div>
                {% endif %}
              </td>
            {% endif %}
          </tr>

      {% endfor %}
    </table>
    {% endif %}

    {% if rtr_appointments|length > 0 %}
    <h2>Ready to Roll</h2><br>

    <table id="chosenboard" style="width: 95%;">

      <tr class="no-border" style="margin-bottom: 5px;">
        <th style="width:15%;">Date</th>
        <th style="width:10%;">Dog</th>
        <th style="width:17%;">Adopter</th>
        {% if request.user|has_group:"admin" %}
          <th style="width:20%;">Last Update Sent</th>
          <th style="width:18%;">Update Status</th>
        {% endif %}
      </tr>

      {% for appt in rtr_appointments %}
        <!-- appts with chosen or paperwork status -->

          <tr>
            <td>{{appt.date}}</td>
            <td>{{appt.dog}}</td>
            <td>
              {{appt.adopter.f_name}} {{appt.adopter.l_name}}
              {% if request.user|has_group:"admin" %}
                <div class="chosen_board_actions" style="display: inline;">
                  <a href="{% url 'clear_from_cb' appt.id %}">(Cancel)</a>
                </div>
              {% endif %}
            </td>

            {% if request.user|has_group:"admin" %}
              <td>
                <div class="chosen_board_actions">
                  {% if appt|alert_overdue == True %}
                    <div class="" style="color: #BF4580;">
                      <b>&#9888;&#xFE0E; {{appt.last_update_sent}}</b>
                    </div>
                  {% else %}
                    <div class="">
                      {{appt.last_update_sent}}
                    </div>
                  {% endif %}
                  {% if request.user|has_group:"admin" %}
                    <a href="{% url 'contact_adopter' appt.id appt.date.year appt.date.month appt.date.day 'update' %}">Send Update</a><br>
                    {% if appt.all_updates_sent|length > 1 %}
                    <span style="font-size: 9pt; font-style: italic; padding-top: 5px;">
                      <b>Previous Updates:</b><br>
                      <ul>
                        {% for update in appt.all_updates_sent %}
                        <li>{{update}}</li>
                        {% endfor %}
                      </ul>
                    </span>
                    {% endif %}
                  {% endif %}
                </div>
              </td>

              <td class="chosenboard">
                {% if appt|is_chosen %}
                  <div class="chosen_board_actions">
                    <!-- <a href="{% url 'cb_update_status' appt.id 9 %}">Chosen - needs vetting</a><br>
                    <a href="{% url 'cb_update_status' appt.id 10 %}">Chosen - needs well check</a><br> -->
                    <a href="{% url 'contact_adopter' appt.id appt.date.year appt.date.month appt.date.day 'ready_negative' %}">Chosen - Dog Vetted</a><br>
                    <a href="{% url 'contact_adopter' appt.id appt.date.year appt.date.month appt.date.day 'ready_positive' %}">Vetted - Heartworm Positive</a>
                  </div>
                {% elif appt.outcome == "7" %}
                  Adopter Notified<br>
                  {% if appt.rtr_notif_date %}
                    ({{appt.rtr_notif_date}})<br>
                  {% endif %}
                  {% if appt.heartworm == True %}
                    <div class="chosen_board_actions">
                      <a class="chosen_board_actions" href="{% url 'paperwork_calendar' today.year today.month today.day appt.id 'positive' %}">Add FTA Appointment</a>
                    </div>
                  {% else %}
                    <div class="chosen_board_actions">
                      <a class="chosen_board_actions" href="{% url 'paperwork_calendar' today.year today.month today.day appt.id 'negative' %}">Add Paperwork Appointment</a>
                    </div>
                  {% endif %}
                  <div class="chosen_board_actions" style="display: inline;">
                    <a href="{% url 'mark_complete_cb' appt.id %}">Mark as Complete</a>
                  </div>
                {% elif appt.outcome == "8" %}
                  Adopter Notified<br>
                  Paperwork Scheduled
                  <div class="chosen_board_actions" style="display: inline;">
                    <a href="{% url 'mark_complete_cb' appt.id %}">(Complete)</a>
                  </div>
                {% endif %}
              </td>
            {% endif %}
          </tr>

      {% endfor %}
    </table>
    {% endif %}

    <h2>Chosen</h2><br>

    <table id="chosenboard" style="width: 95%;">

      <tr class="no-border" style="margin-bottom: 5px;">
        <th style="width:10%;">Date</th>
        <th style="width:10%;">Dog</th>
        <th style="width:15%;">Outcome</th>
        <th style="width:17%;">Adopter</th>
        {% if request.user|has_group:"admin" %}
          <th style="width:20%;">Last Update Sent</th>
          <th style="width:18%;">Update Status</th>
        {% endif %}
      </tr>

      {% for appt in chosen_appointments %}
        <!-- appts with chosen or paperwork status -->

          <tr>
            <td>{{appt.date}}</td>
            <td>{{appt.dog}}</td>
            <td>
              {{appt.get_outcome_display}}<br>
              {% if appt.outcome != "9" %}
              <div class="chosen_board_actions">
                <a href="{% url 'cb_update_status' appt.id 9 %}">Needs vetting</a><br>
              </div>
              {% endif %}
              {% if appt.outcome != "10" %}
              <div class="chosen_board_actions">
                <a href="{% url 'cb_update_status' appt.id 10 %}">Needs well check</a><br>
              </div>
              {% endif %}
            </td>
            <td>
              {{appt.adopter.f_name}} {{appt.adopter.l_name}}
              {% if request.user|has_group:"admin" %}
                <div class="chosen_board_actions" style="display: inline;">
                  <a href="{% url 'clear_from_cb' appt.id %}">(Cancel)</a>
                </div>
              {% endif %}
            </td>

            {% if request.user|has_group:"admin" %}
              <td>
                <div class="chosen_board_actions">
                  {% if appt|alert_overdue == True %}
                    <div class="" style="color: #BF4580;">
                      <b>&#9888;&#xFE0E; {{appt.last_update_sent}}</b>
                    </div>
                  {% else %}
                    <div class="">
                      {{appt.last_update_sent}}
                    </div>
                  {% endif %}
                  {% if request.user|has_group:"admin" %}
                    <a href="{% url 'contact_adopter' appt.id appt.date.year appt.date.month appt.date.day 'update' %}">Send Update</a><br>
                    {% if appt.all_updates_sent|length > 1 %}
                    <span style="font-size: 9pt; font-style: italic; padding-top: 5px;">
                      <b>Previous Updates:</b><br>
                      <ul>
                        {% for update in appt.all_updates_sent %}
                        <li>{{update}}</li>
                        {% endfor %}
                      </ul>
                    </span>
                    {% endif %}
                  {% endif %}
                </div>
              </td>

              <td class="chosenboard">
                {% if appt|is_chosen %}
                  <div class="chosen_board_actions">
                    <a href="{% url 'contact_adopter' appt.id appt.date.year appt.date.month appt.date.day 'ready_negative' %}">Chosen - Dog Vetted</a><br>
                    <a href="{% url 'contact_adopter' appt.id appt.date.year appt.date.month appt.date.day 'ready_positive' %}">Vetted - Heartworm Positive</a>
                  </div>
                {% elif appt.outcome == "7" %}
                  Adopter Notified<br>
                  {% if appt.rtr_notif_date %}
                    ({{appt.rtr_notif_date}})<br>
                  {% endif %}
                  {% if appt.heartworm == True %}
                    <div class="chosen_board_actions">
                      <a class="chosen_board_actions" href="{% url 'paperwork_calendar' today.year today.month today.day appt.id 'positive' %}">Add FTA Appointment</a>
                    </div>
                  {% else %}
                    <div class="chosen_board_actions">
                      <a class="chosen_board_actions" href="{% url 'paperwork_calendar' today.year today.month today.day appt.id 'negative' %}">Add Paperwork Appointment</a>
                    </div>
                  {% endif %}
                {% elif appt.outcome == "8" %}
                  Adopter Notified<br>
                  Paperwork Scheduled
                  <div class="chosen_board_actions" style="display: inline;">
                    <a href="{% url 'mark_complete_cb' appt.id %}">(Complete)</a>
                  </div>
                {% endif %}
              </td>
            {% endif %}
          </tr>

      {% endfor %}
    </table>

  </div>
{% endblock %}
